SELECT *  FROM
(SELECT C1.CITY,C1.CONTACT_NAME,TMP.CUSTOMER_ID,TMP.CT,DENSE_RANK OVER(PARTITION BY C1.CITY ORDER BY TMP.CT) PR FROM CUSTOMER C1, 
(SELECT C.CUSTOMER_ID,COUNT(*) CT FROM CUSTOMER C JOIN ORDERS O ON C.CUSTOMER_ID=O.CUSTOMER_ID
GROUP BY C.CUSTOMER_ID)TMP
WHERE C1.CUSTOMER_ID=TMP.CUSTOMERF_ID)TMP2
WHERE PR<=3;

DELETE FROM DUP
WHERE ROWID NOT IN (SELECT MIN(ROEID) FROM DUP GROUP BY NAME,SAL);
